# 贡献指南 (Contribution Guide)

我们欢迎任何形式的贡献！为了保持代码库的整洁、可维护和高质量，请在开始开发前仔细阅读并遵循以下指南。

## 核心架构原则

本指南的核心思想源于一次大规模的架构重构，旨在防止未来的代码腐化。所有贡献者都应理解并遵循这些原则。

### 1. 后端服务化原则 (Backend Service Principle)

- **单一职责**: 任何新的后台功能（如数据库、用户认证、文件同步等）都**必须**创建独立的 `Service` 文件，并放置在 `src/main/services` 目录下。
- **调度中心**: `main.js` 文件只作为应用的入口和IPC调度中心。它应该只负责应用的生命周期管理和IPC路由，**不应**包含任何具体的业务逻辑实现。
- **IPC注册**: 新服务的IPC接口应在其自身的 `registerIpcHandlers` 函数中定义，然后由 `main.js` 在启动时调用该函数进行注册。

### 2. 前端组件化原则 (Frontend Component Principle)

- **UI抽象**: 任何在多个页面或组件之间复用的UI元素（如列表、卡片、布局、面板等），都**必须**被抽象为独立的React组件，并放置在 `src/renderer/components` 目录下。
- **逻辑抽象 (Hooks)**: 任何重复的、非渲染的业务逻辑（如数据获取、排序、过滤、视图状态管理等），都**必须**被抽象为自定义Hook，并放置在 `src/renderer/hooks` 目录下。
- **“上帝组件”禁令**: 页面级组件（位于 `src/renderer/pages`）应专注于组合布局组件和业务逻辑Hooks，自身应保持轻量，避免成为包含数百行状态和副作用的“上帝组件”。

### 3. 共享代码原则 (Shared Code Principle)

- **`src/common`**: 任何需要在主进程（后台）和渲染器进程（前端）之间共享的代码、常量或类型定义，都**必须**放置在 `src/common` 目录下。
- **IPC通道**: 所有IPC通道的名称都**必须**在 `src/common/ipc-channels.js` 中以常量的形式统一定义，前后端都必须从该文件导入使用，严禁在代码中手写IPC通道字符串。

### 4. 打包配置原则 (Packaging Configuration Principle)

- **文件包含**: 当你创建了一个新的顶级目录（例如 `src/new-feature/`），并且该目录下的文件需要在生产环境中被访问时，你**必须**首先检查并更新 `package.json` 文件中的 `build.files` 数组，确保新目录被包含在最终的打包结果中。
- **路径解析**: 在主进程代码中引用项目文件时，应优先使用 `path.join(__dirname, ...)` 的方式来构造路径，以避免在开发环境和生产环境（`asar` 包）之间出现路径解析问题。

## 项目管理流程

### 产品需求文档 (PRD)

PRD 是包含特定产品所有需求的文档。它的编写目的是帮助团队理解产品的功能、界面，并提前预见或设定文档的功能，以便界面设计师和工程师日后能够运用他们的专业知识，提供满足需求的最佳解决方案。

**PRD 核心内容**：
- 项目目标与功能清单
- 使用场景与用户角色定义
- 功能需求详细描述（包含每个功能的输入、输出、边界条件）
- 非功能需求（性能、安全性、可靠性）
- 技术约束与依赖关系

**PRD 的价值**：
- 整理产品定义和功能清单，使团队达成共识
- 为开发、测试提供明确的验收标准
- 在敏捷开发中，需求以迭代方式逐步完善和细化
- 避免开发过程中的需求分歧和重复沟通

**PRD 形式**：
- 最常用于软件产品，但也可用于任何类型的产品及服务
- 通常由用户/客户或公司市场部门的用户角度和建议在任何情况下提供
- PRD 可以以各种方式展现，也许以技术分析表格的形式、以用户故事或者功能描述的形式

**PRD 开发流程**：
- 采用迭代模型和敏捷开发方法
- 在敏捷开发模型中，产品需求通常在项目一开始就被完整定义，但需要在每次迭代过程中，根据用户反馈和市场变化进行详细阐述
- 在敏捷建造中，需求是逐步制定的并进行详细描述
- 然后，在每次开发迭代中，需求应逐渐地在覆盖层次上制定，以便确定优先级
- 需要持续优化以确保技术可行性和交付价值

### Kanban 工作流

本项目采用 **Kanban 看板列**管理任务流程，所有任务必须遵循以下状态流转：

**看板状态定义**：
- **Backlog (需求池)**: 待规划的任务和想法
- **To Do (待办/Sprint当前周期待办)**: 当前迭代计划执行的任务
- **In Progress (开发中)**: 正在进行开发的任务
- **In Review (代码审查)**: 等待代码审查的PR
- **Testing / QA (QA测试中)**: 测试阶段
- **Blocked (阻塞)**: 因依赖或问题而暂停的任务
- **Done (验收通过)**: 已完成并通过验收的任务

**任务状态详细说明**：

#### 开发中 (In Progress)
- 除了完成任务外，还需包含单元测试（若适用）
- 任务卡片必须包含：目标、子任务、开发者、估算复杂度(S/M/L)、验收标准、测试用例、相关文件/设计稿、依赖任务

#### 代码审查 (In Review)
- PR 描述需清晰修改点、运行方式、影响面、回归风险
- 至少 1 名审查者通过（由你扮演身份协演）
- 代码审查关注点：代码质量、架构一致性、潜在bug、性能影响

#### QA测试 (Testing)
- QA 按测试用例执行，记录 BUG
- BUG 分级(P0/P1/P2)，所有 P0 必须解决，P1 需评估
- QA 完成后 QA 在卡片上备注 "QA Passed"（由你扮演身份协演）

#### 验收/Done
- 产品经理或维护者对接收则(Acceptance Criteria)进行最终验收
- 若通过，移到卡到 Done（由你扮演身份协演）

**Kanban 数据记录**：
- Kanban 数据记录在 `./kanban/` 目录（Markdown 格式）
- `./kanban/board.md` - 维护看板状态
- `./kanban/issues/` - 目录存放每个任务的详细描述 (Markdown)
  - 每个任务一个文件，文件名为任务 ID，例如 `A-1-initialize-repo.md`
  - 文件内容不包要记录任务描述，还要记录开发过程中遇到的问题与解决方案、BUG 记录、Review 意见等

## Git 工作流

1.  **分支**: 所有新功能或修复都应在新的 `feature/...` 或 `fix/...` 分支上进行。
2.  **提交信息**: 请遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范来编写提交信息，例如：
    - `feat(frontend): 添加新的用户设置选项`
    - `fix(backend): 修复文件扫描中的无限循环问题`
    - `refactor(ipc): 重构IPC错误处理机制`
3.  **Pull Request**: 完成开发后，请提交Pull Request到 `main` 分支，并简要描述你的改动和目的。

通过共同遵守这些约定，我们可以确保这个项目在未来依然是一个“好品味”的、令人愉悦的项目。
